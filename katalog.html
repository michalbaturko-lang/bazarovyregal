<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>V≈°echny reg√°ly - 102 produkt≈Ø skladem | Bazarovyregal.cz</title>
  <meta name="description" content="Kompletn√≠ nab√≠dka kovov√Ωch reg√°l≈Ø. 102 typ≈Ø skladem, doprava od 99 Kƒç. Filtry podle barvy, rozmƒõr≈Ø, nosnosti. Likvidace skladu - slevy a≈æ 50%.">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          colors: {
            primary: { 50: '#fff7ed', 100: '#ffedd5', 200: '#fed7aa', 300: '#fdba74', 400: '#fb923c', 500: '#f97316', 600: '#ea580c', 700: '#c2410c', 800: '#9a3412', 900: '#7c2d12' }
          }
        }
      }
    }
  </script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .product-card { transition: all 0.2s; }
    .product-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.1); }
    .filter-chip { transition: all 0.15s; }
    .filter-chip:hover { background: #fed7aa; }
    .filter-chip.active { background: #f97316; color: white; }
    .range-slider { -webkit-appearance: none; background: #e5e7eb; height: 6px; border-radius: 3px; }
    .range-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: #f97316; border-radius: 50%; cursor: pointer; }
    .search-dropdown { max-height: 500px; }
    .notification-toast { animation: slideIn 0.3s ease, slideOut 0.3s ease 4.7s; }
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
    .pulse-dot { animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
  </style>
</head>
<body class="bg-gray-50">

<!-- LIVE NOTIFICATION TOAST -->
<div id="notificationContainer" class="fixed top-20 right-4 z-50 space-y-2"></div>

<!-- EXIT INTENT POPUP -->
<div id="exitPopup" class="fixed inset-0 bg-black/60 z-[100] hidden items-center justify-center">
  <div class="bg-white rounded-2xl max-w-md mx-4 overflow-hidden shadow-2xl transform scale-95 transition-transform" id="exitPopupContent">
    <div class="bg-gradient-to-r from-primary-500 to-orange-500 text-white p-6 text-center">
      <span class="text-5xl">üéÅ</span>
      <h2 class="text-2xl font-bold mt-2">Poƒçkejte! M√°me pro v√°s d√°rek</h2>
    </div>
    <div class="p-6 text-center">
      <p class="text-gray-600 mb-4">Z√≠skejte <strong class="text-primary-600">slevu 10%</strong> na prvn√≠ objedn√°vku!</p>
      <div class="bg-gray-100 rounded-lg p-4 mb-4">
        <span class="text-2xl font-mono font-bold tracking-wider">PRVNI10</span>
      </div>
      <p class="text-sm text-gray-500 mb-6">Plat√≠ pouze dnes p≈ôi objedn√°vce nad 1000 Kƒç</p>
      <a href="?sleva=PRVNI10" class="block w-full bg-primary-500 hover:bg-primary-600 text-white py-3 rounded-lg font-bold transition mb-3">
        Uplatnit slevu ‚Üí
      </a>
      <button onclick="closeExitPopup()" class="text-gray-400 hover:text-gray-600 text-sm">Ne, dƒõkuji</button>
    </div>
  </div>
</div>

<!-- Header with SEARCH -->
<header class="bg-white shadow-sm sticky top-0 z-40">
  <div class="container mx-auto px-4 py-3">
    <div class="flex items-center justify-between gap-4">
      <!-- Logo -->
      <a href="index.html" class="flex items-center gap-2 flex-shrink-0">
        <div class="w-10 h-10 bg-primary-500 rounded-xl flex items-center justify-center shadow-lg">
          <span class="text-white text-2xl font-black">B</span>
        </div>
        <div class="hidden sm:block">
          <div class="text-lg font-bold text-gray-900">Bazarovyregal<span class="text-primary-500">.cz</span></div>
          <div class="text-xs text-red-600 font-medium">Likvidace skladu</div>
        </div>
      </a>

      <!-- LUIGI'S BOX STYLE SEARCH -->
      <div class="flex-1 max-w-2xl relative">
        <div class="relative">
          <input
            type="text"
            id="searchInput"
            placeholder="Hledat reg√°ly... (nap≈ô. 180 cm, ƒçern√Ω, do gar√°≈æe)"
            class="w-full border-2 border-gray-200 rounded-xl py-3 px-5 pr-24 focus:border-primary-500 focus:outline-none text-sm"
            onkeyup="handleSearch(event)"
            onfocus="showSearchDropdown()"
            autocomplete="off"
          >
          <button onclick="performSearch()" class="absolute right-2 top-1/2 -translate-y-1/2 bg-primary-500 hover:bg-primary-600 text-white px-5 py-2 rounded-lg font-medium text-sm transition">
            HLEDAT
          </button>
        </div>

        <!-- Search Dropdown - Luigi's Box Style -->
        <div id="searchDropdown" class="search-dropdown absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-2xl border overflow-hidden hidden z-50">
          <div class="grid md:grid-cols-3 divide-x">
            <!-- Kategorie -->
            <div class="p-4">
              <h3 class="text-xs font-bold text-primary-500 uppercase mb-3">Kategorie</h3>
              <div id="searchCategories" class="space-y-2">
                <!-- Dynamicky -->
              </div>
            </div>

            <!-- Top produkt -->
            <div class="p-4 bg-gray-50">
              <h3 class="text-xs font-bold text-primary-500 uppercase mb-3">Top produkt</h3>
              <div id="searchTopProduct">
                <!-- Dynamicky -->
              </div>
            </div>

            <!-- Produkty -->
            <div class="p-4">
              <h3 class="text-xs font-bold text-primary-500 uppercase mb-3">Produkty</h3>
              <div id="searchProducts" class="space-y-3 max-h-80 overflow-y-auto">
                <!-- Dynamicky -->
              </div>
              <a href="#" id="searchShowAll" class="block mt-4 text-center bg-primary-500 hover:bg-primary-600 text-white py-2 rounded-lg font-medium text-sm transition">
                ZOBRAZIT V≈†ECHNY PRODUKTY
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Cart -->
      <div class="flex items-center gap-4">
        <a href="quiz.html" class="hidden md:flex items-center gap-1 text-sm text-gray-600 hover:text-primary-500">
          <span>üéØ</span> Quiz
        </a>
        <button class="relative bg-primary-500 text-white px-4 py-2 rounded-lg font-medium">
          üõí Ko≈°√≠k
          <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">0</span>
        </button>
      </div>
    </div>
  </div>

  <!-- FREE SHIPPING BAR -->
  <div class="bg-gradient-to-r from-green-500 to-emerald-500 text-white py-2">
    <div class="container mx-auto px-4 text-center text-sm">
      <span id="shippingBar">üöö P≈ôidejte zbo≈æ√≠ za <strong>1000 Kƒç</strong> a z√≠skejte <strong>dopravu ZDARMA!</strong></span>
    </div>
  </div>

  <!-- Navigation -->
  <div class="bg-white border-t">
    <div class="container mx-auto px-4">
      <nav class="flex gap-1 py-2 overflow-x-auto">
        <a href="index.html" class="px-3 py-1.5 text-sm font-medium text-gray-600 hover:text-primary-500 hover:bg-primary-50 rounded-lg whitespace-nowrap transition-colors">üè† √övod</a>
        <a href="katalog.html" class="px-3 py-1.5 text-sm font-medium text-primary-500 bg-primary-50 rounded-lg whitespace-nowrap">üì¶ V≈°echny reg√°ly</a>
        <a href="o-nas.html" class="px-3 py-1.5 text-sm font-medium text-gray-600 hover:text-primary-500 hover:bg-primary-50 rounded-lg whitespace-nowrap transition-colors">‚ÑπÔ∏è O n√°s</a>
        <a href="faq.html" class="px-3 py-1.5 text-sm font-medium text-gray-600 hover:text-primary-500 hover:bg-primary-50 rounded-lg whitespace-nowrap transition-colors">‚ùì FAQ</a>
        <a href="kontakt.html" class="px-3 py-1.5 text-sm font-medium text-gray-600 hover:text-primary-500 hover:bg-primary-50 rounded-lg whitespace-nowrap transition-colors">üìß Kontakt</a>
      </nav>
    </div>
  </div>
</header>

<!-- Breadcrumb + Count -->
<div class="bg-white border-b">
  <div class="container mx-auto px-4 py-3 flex items-center justify-between">
    <nav class="text-sm text-gray-500">
      <a href="index.html" class="hover:text-primary-500">√övod</a>
      <span class="mx-2">‚Ä∫</span>
      <span class="text-gray-900 font-medium">V≈°echny reg√°ly</span>
    </nav>
    <div class="text-sm text-gray-500">
      <span id="productCount">102</span> produkt≈Ø
    </div>
  </div>
</div>

<main class="container mx-auto px-4 py-8">
  <div class="flex flex-col lg:flex-row gap-8">

    <!-- SIDEBAR FILTERS -->
    <aside class="lg:w-72 flex-shrink-0">
      <div class="bg-white rounded-2xl shadow-sm p-6 sticky top-36">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-lg font-bold">Filtry</h2>
          <button onclick="resetFilters()" class="text-primary-500 text-sm hover:underline">Resetovat</button>
        </div>

        <!-- Barva -->
        <div class="mb-6">
          <h3 class="font-medium mb-3">Barva</h3>
          <div class="flex flex-wrap gap-2">
            <button onclick="toggleFilter('color', 'ƒåern√°')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="color-ƒåern√°">‚¨õ ƒåern√°</button>
            <button onclick="toggleFilter('color', 'B√≠l√°')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="color-B√≠l√°">‚¨ú B√≠l√°</button>
            <button onclick="toggleFilter('color', 'ƒåerven√°')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="color-ƒåerven√°">üü• ƒåerven√°</button>
            <button onclick="toggleFilter('color', 'Modr√°')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="color-Modr√°">üü¶ Modr√°</button>
            <button onclick="toggleFilter('color', 'Zinkovan√Ω')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="color-Zinkovan√Ω">üîò Zink</button>
          </div>
        </div>

        <!-- V√Ω≈°ka -->
        <div class="mb-6">
          <h3 class="font-medium mb-3">V√Ω≈°ka</h3>
          <div class="flex flex-wrap gap-2">
            <button onclick="toggleFilter('height', '150')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="height-150">150 cm</button>
            <button onclick="toggleFilter('height', '180')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="height-180">180 cm</button>
            <button onclick="toggleFilter('height', '200')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="height-200">200 cm</button>
            <button onclick="toggleFilter('height', '220')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="height-220">220 cm</button>
          </div>
        </div>

        <!-- ≈†√≠≈ôka -->
        <div class="mb-6">
          <h3 class="font-medium mb-3">≈†√≠≈ôka</h3>
          <div class="flex flex-wrap gap-2">
            <button onclick="toggleFilter('width', '40')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="width-40">40 cm</button>
            <button onclick="toggleFilter('width', '60')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="width-60">60 cm</button>
            <button onclick="toggleFilter('width', '70')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="width-70">70 cm</button>
            <button onclick="toggleFilter('width', '90')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="width-90">90 cm</button>
            <button onclick="toggleFilter('width', '120')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="width-120">120 cm</button>
          </div>
        </div>

        <!-- Povrch -->
        <div class="mb-6">
          <h3 class="font-medium mb-3">Povrch</h3>
          <div class="flex flex-wrap gap-2">
            <button onclick="toggleFilter('surface', 'Lakovan√Ω')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="surface-Lakovan√Ω">Lakovan√Ω</button>
            <button onclick="toggleFilter('surface', 'Pozinkovan√Ω')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="surface-Pozinkovan√Ω">Pozinkovan√Ω</button>
          </div>
        </div>

        <!-- Cena -->
        <div class="mb-6">
          <h3 class="font-medium mb-3">Cena</h3>
          <div class="space-y-2">
            <input type="range" min="400" max="2000" value="2000" id="priceRange" class="range-slider w-full" onchange="filterByPrice(this.value)">
            <div class="flex justify-between text-sm text-gray-500">
              <span>400 Kƒç</span>
              <span id="priceRangeValue">2000 Kƒç</span>
            </div>
          </div>
        </div>

        <!-- Nosnost -->
        <div class="mb-6">
          <h3 class="font-medium mb-3">Nosnost celkem</h3>
          <div class="flex flex-wrap gap-2">
            <button onclick="toggleFilter('capacity', '700')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="capacity-700">700+ kg</button>
            <button onclick="toggleFilter('capacity', '875')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="capacity-875">875+ kg</button>
          </div>
        </div>

        <!-- Pou≈æit√≠ -->
        <div>
          <h3 class="font-medium mb-3">Ide√°ln√≠ do</h3>
          <div class="flex flex-wrap gap-2">
            <button onclick="toggleFilter('usage', 'garaz')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="usage-garaz">üöó Gar√°≈æ</button>
            <button onclick="toggleFilter('usage', 'sklep')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="usage-sklep">üç∑ Sklep</button>
            <button onclick="toggleFilter('usage', 'dilna')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="usage-dilna">üîß D√≠lna</button>
            <button onclick="toggleFilter('usage', 'kancelar')" class="filter-chip px-3 py-1.5 rounded-full border text-sm" data-filter="usage-kancelar">üìÅ Kancel√°≈ô</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- PRODUCT GRID -->
    <div class="flex-1">
      <!-- Sorting & View Toggle -->
      <div class="flex items-center justify-between mb-6 bg-white rounded-xl p-4 shadow-sm">
        <div class="flex items-center gap-4">
          <span class="text-sm text-gray-500">≈òadit:</span>
          <select id="sortSelect" onchange="sortProducts()" class="border rounded-lg px-3 py-2 text-sm">
            <option value="popular">Nejprod√°vanƒõj≈°√≠</option>
            <option value="price-asc">Cena: od nejni≈æ≈°√≠</option>
            <option value="price-desc">Cena: od nejvy≈°≈°√≠</option>
            <option value="name">N√°zev A-Z</option>
            <option value="capacity">Nosnost: od nejvy≈°≈°√≠</option>
          </select>
        </div>
        <div class="flex items-center gap-2">
          <button onclick="setView('grid')" id="viewGrid" class="p-2 rounded-lg bg-primary-100 text-primary-600">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
          </button>
          <button onclick="setView('list')" id="viewList" class="p-2 rounded-lg hover:bg-gray-100">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
          </button>
        </div>
      </div>

      <!-- Active filters -->
      <div id="activeFilters" class="flex flex-wrap gap-2 mb-4 hidden">
        <!-- Dynamicky -->
      </div>

      <!-- Products Grid -->
      <div id="productGrid" class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4">
        <!-- Dynamicky generov√°no -->
      </div>

      <!-- Pagination -->
      <div class="flex justify-center mt-8">
        <div class="flex items-center gap-2">
          <button onclick="changePage(-1)" class="px-4 py-2 border rounded-lg hover:bg-gray-100">‚Üê P≈ôedchoz√≠</button>
          <span id="pagination" class="flex gap-1">
            <!-- Dynamicky -->
          </span>
          <button onclick="changePage(1)" class="px-4 py-2 border rounded-lg hover:bg-gray-100">Dal≈°√≠ ‚Üí</button>
        </div>
      </div>
    </div>

  </div>
</main>

<!-- COUNTDOWN BANNER -->
<div class="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-red-600 to-red-500 text-white py-3 z-30">
  <div class="container mx-auto px-4 flex items-center justify-center gap-4 text-center">
    <span class="text-lg">üî• <strong>LIKVIDACE SKLADU</strong> konƒç√≠ za:</span>
    <div class="flex gap-2">
      <div class="bg-white/20 rounded px-3 py-1"><span id="countdownDays" class="font-bold">2</span><span class="text-xs"> dny</span></div>
      <div class="bg-white/20 rounded px-3 py-1"><span id="countdownHours" class="font-bold">14</span><span class="text-xs"> hod</span></div>
      <div class="bg-white/20 rounded px-3 py-1"><span id="countdownMins" class="font-bold">32</span><span class="text-xs"> min</span></div>
    </div>
    <a href="#" class="bg-white text-red-600 px-4 py-1 rounded-lg font-bold text-sm hover:bg-gray-100 transition">NAKOUPIT ‚Üí</a>
  </div>
</div>

<!-- AI CHAT WIDGET -->
<div id="chatWidget" class="fixed bottom-20 right-4 z-40">
  <button onclick="toggleChat()" id="chatButton" class="bg-primary-500 hover:bg-primary-600 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-2xl transition-transform hover:scale-110">
    üí¨
  </button>

  <!-- Chat Window -->
  <div id="chatWindow" class="hidden absolute bottom-16 right-0 w-80 sm:w-96 bg-white rounded-2xl shadow-2xl overflow-hidden">
    <div class="bg-gradient-to-r from-primary-500 to-orange-500 text-white p-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">ü§ñ</div>
          <div>
            <div class="font-bold">Reg√°lBot</div>
            <div class="text-xs text-white/80 flex items-center gap-1">
              <span class="w-2 h-2 bg-green-400 rounded-full pulse-dot"></span> Online
            </div>
          </div>
        </div>
        <button onclick="toggleChat()" class="text-white/80 hover:text-white">‚úï</button>
      </div>
    </div>

    <div id="chatMessages" class="h-80 overflow-y-auto p-4 space-y-4">
      <div class="flex gap-3">
        <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0">ü§ñ</div>
        <div class="bg-gray-100 rounded-2xl rounded-tl-none p-3 text-sm max-w-[80%]">
          Ahoj! üëã Jsem Reg√°lBot a pomohu v√°m vybrat ide√°ln√≠ reg√°l. Na co se chcete zeptat?
        </div>
      </div>
    </div>

    <div class="border-t p-4">
      <div class="flex gap-2">
        <input type="text" id="chatInput" placeholder="Napi≈°te zpr√°vu..." class="flex-1 border rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary-500" onkeypress="if(event.key==='Enter')sendMessage()">
        <button onclick="sendMessage()" class="bg-primary-500 hover:bg-primary-600 text-white px-4 py-2 rounded-lg transition">‚û§</button>
      </div>
      <div class="flex flex-wrap gap-1 mt-2">
        <button onclick="quickQuestion('Jak√Ω reg√°l do gar√°≈æe?')" class="text-xs bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded-full">üöó Do gar√°≈æe</button>
        <button onclick="quickQuestion('Reg√°l do vlhka?')" class="text-xs bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded-full">üíß Do vlhka</button>
        <button onclick="quickQuestion('Nejlevnƒõj≈°√≠ reg√°l?')" class="text-xs bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded-full">üí∞ Nejlevnƒõj≈°√≠</button>
      </div>
    </div>
  </div>
</div>

<script>
// ========== PRODUCT DATA (102 produkt≈Ø) ==========
const allProducts = [
  { id: 1, code: "15070304700BLACK1", name: "Reg√°l 150√ó70√ó30 cm ƒçern√Ω", price: 599, priceOrig: 1198, height: 150, width: 70, depth: 30, color: "ƒåern√°", surface: "Lakovan√Ω", shelves: 4, capacity: 700, image: "https://vyprodej-regalucz.s26.cdn-upgates.com/v/v6903779a99ff1-1-regal-1500x700x300-mm-lakovany-4-policovy-nosnost-700-kg-cerny-pravy-15070304700black1.jpeg", seoUrl: "regal-1500x700x300-mm-lakovany-4-policovy-nosnost-700-kg-cerny", stock: 47, sold7days: 23 },
  { id: 2, code: "15070304700RED1", name: "Reg√°l 150√ó70√ó30 cm ƒçerven√Ω", price: 599, priceOrig: 1198, height: 150, width: 70, depth: 30, color: "ƒåerven√°", surface: "Lakovan√Ω", shelves: 4, capacity: 700, image: "https://vyprodej-regalucz.s26.cdn-upgates.com/c/c690377c0d46a4-1-regal-1800x900x400-mm-lakovany-5-policovy-nosnost-875-kg-cerveny-pravy-18090405875red1.jpeg", seoUrl: "regal-1500x700x300-mm-lakovany-4-policovy-nosnost-700-kg-cerveny", stock: 31, sold7days: 12 },
  { id: 3, code: "15070304700WHITE1", name: "Reg√°l 150√ó70√ó30 cm b√≠l√Ω", price: 599, priceOrig: 1198, height: 150, width: 70, depth: 30, color: "B√≠l√°", surface: "Lakovan√Ω", shelves: 4, capacity: 700, image: "https://vyprodej-regalucz.s26.cdn-upgates.com/6/6690a777ad6edc-1-18090405875white1.jpeg", seoUrl: "regal-1500x700x300-mm-lakovany-4-policovy-nosnost-700-kg-bily", stock: 28, sold7days: 15 },
  { id: 4, code: "18090405875BLACK1", name: "Reg√°l 180√ó90√ó40 cm ƒçern√Ω", price: 739, priceOrig: 1478, height: 180, width: 90, depth: 40, color: "ƒåern√°", surface: "Lakovan√Ω", shelves: 5, capacity: 875, image: "https://vyprodej-regalucz.s26.cdn-upgates.com/l/l690377af7480a-1-regal-1800x900x400-mm-lakovany-5-policovy-nosnost-875-kg-cerny-pravy-18090405875black1.jpeg", seoUrl: "regal-1800x900x400-mm-lakovany-5-policovy-nosnost-875-kg-cerny", stock: 156, sold7days: 89, bestseller: true },
  { id: 5, code: "18090405875WHITE1", name: "Reg√°l 180√ó90√ó40 cm b√≠l√Ω", price: 739, priceOrig: 1478, height: 180, width: 90, depth: 40, color: "B√≠l√°", surface: "Lakovan√Ω", shelves: 5, capacity: 875, image: "https://vyprodej-regalucz.s26.cdn-upgates.com/6/6690a777ad6edc-1-18090405875white1.jpeg", seoUrl: "regal-1800x900x400-mm-lakovany-5-policovy-nosnost-875-kg-bily", stock: 98, sold7days: 67 },
  { id: 6, code: "18090405875ZINK", name: "Reg√°l 180√ó90√ó40 cm zinkovan√Ω", price: 649, priceOrig: 1298, height: 180, width: 90, depth: 40, color: "Zinkovan√Ω", surface: "Pozinkovan√Ω", shelves: 5, capacity: 875, image: "https://vyprodej-regalucz.s26.cdn-upgates.com/z/z6914605330838-5-pol-pravy-zink.jpg", seoUrl: "regal-1800x900x400-mm-pozinkovany-5-policovy-nosnost-875-kg", stock: 203, sold7days: 78 },
  { id: 7, code: "18060405875BLACK1", name: "Reg√°l 180√ó60√ó40 cm ƒçern√Ω", price: 689, priceOrig: 1378, height: 180, width: 60, depth: 40, color: "ƒåern√°", surface: "Lakovan√Ω", shelves: 5, capacity: 875, image: "https://vyprodej-regalucz.s26.cdn-upgates.com/j/j690377a5dc94d-1-regal-1800x600x400-mm-lakovany-5-policovy-nosnost-875-kg-cerny-pravy-18060405875black1.jpeg", seoUrl: "regal-1800x600x400-mm-lakovany-5-policovy-nosnost-875-kg-cerny", stock: 67, sold7days: 34 },
  { id: 8, code: "18040405875BLACK1", name: "Reg√°l 180√ó40√ó40 cm ƒçern√Ω", price: 629, priceOrig: 1258, height: 180, width: 40, depth: 40, color: "ƒåern√°", surface: "Lakovan√Ω", shelves: 5, capacity: 875, image: "https://vyprodej-regalucz.s26.cdn-upgates.com/2/2690377a330269-1-regal-1800x400x400-mm-lakovany-5-policovy-nosnost-875-kg-cerny-pravy-18040405875black1.jpeg", seoUrl: "regal-1800x400x400-mm-lakovany-5-policovy-nosnost-875-kg-cerny", stock: 45, sold7days: 21 },
  { id: 9, code: "20090405875BLACK1", name: "Reg√°l 200√ó90√ó40 cm ƒçern√Ω", price: 849, priceOrig: 1698, height: 200, width: 90, depth: 40, color: "ƒåern√°", surface: "Lakovan√Ω", shelves: 5, capacity: 875, image: "https://vyprodej-regalucz.s26.cdn-upgates.com/l/l690377af7480a-1-regal-1800x900x400-mm-lakovany-5-policovy-nosnost-875-kg-cerny-pravy-18090405875black1.jpeg", seoUrl: "regal-2000x900x400-mm-lakovany-5-policovy-nosnost-875-kg-cerny", stock: 34, sold7days: 19 },
  { id: 10, code: "22090455875BLACK1", name: "Reg√°l 220√ó90√ó45 cm ƒçern√Ω", price: 899, priceOrig: 1798, height: 220, width: 90, depth: 45, color: "ƒåern√°", surface: "Lakovan√Ω", shelves: 5, capacity: 875, image: "https://vyprodej-regalucz.s26.cdn-upgates.com/l/l690377af7480a-1-regal-1800x900x400-mm-lakovany-5-policovy-nosnost-875-kg-cerny-pravy-18090405875black1.jpeg", seoUrl: "regal-2200x900x450-mm-lakovany-5-policovy-nosnost-875-kg-cerny", stock: 23, sold7days: 11 },
  { id: 11, code: "18012005875BLACK1", name: "Reg√°l 180√ó120√ó50 cm ƒçern√Ω", price: 1149, priceOrig: 2298, height: 180, width: 120, depth: 50, color: "ƒåern√°", surface: "Lakovan√Ω", shelves: 5, capacity: 875, image: "https://vyprodej-regalucz.s26.cdn-upgates.com/l/l690377af7480a-1-regal-1800x900x400-mm-lakovany-5-policovy-nosnost-875-kg-cerny-pravy-18090405875black1.jpeg", seoUrl: "regal-1800x1200x500-mm-lakovany-5-policovy-nosnost-875-kg-cerny", stock: 19, sold7days: 8 },
  { id: 12, code: "18090405875BLUE1", name: "Reg√°l 180√ó90√ó40 cm modr√Ω", price: 759, priceOrig: 1518, height: 180, width: 90, depth: 40, color: "Modr√°", surface: "Lakovan√Ω", shelves: 5, capacity: 875, image: "https://vyprodej-regalucz.s26.cdn-upgates.com/b/b690377c6f0f7e-1-regal-1800x900x400-mm-lakovany-5-policovy-nosnost-875-kg-modry-pravy-18090405875blue1.jpeg", seoUrl: "regal-1800x900x400-mm-lakovany-5-policovy-nosnost-875-kg-modry", stock: 15, sold7days: 7 },
];

// Fix prices: double original prices and recalculate discounts
for (let i = 0; i < allProducts.length; i++) {
  const p = allProducts[i];
  if (i < 12) {
    // For manually defined products, double the original price and recalculate discount
    p.priceOrig = p.priceOrig * 2;
  }
}

// Generov√°n√≠ dal≈°√≠ch produkt≈Ø pro celkov√Ω poƒçet 102
const colors = ["ƒåern√°", "B√≠l√°", "ƒåerven√°", "Modr√°", "Zinkovan√Ω"];
const heights = [150, 180, 200, 220];
const widths = [40, 60, 70, 90, 120];
const depths = [30, 40, 45, 50];

// Obr√°zky podle barvy
const colorImages = {
  "ƒåern√°": "https://vyprodej-regalucz.s26.cdn-upgates.com/l/l690377af7480a-1-regal-1800x900x400-mm-lakovany-5-policovy-nosnost-875-kg-cerny-pravy-18090405875black1.jpeg",
  "B√≠l√°": "https://vyprodej-regalucz.s26.cdn-upgates.com/6/6690a777ad6edc-1-18090405875white1.jpeg",
  "ƒåerven√°": "https://vyprodej-regalucz.s26.cdn-upgates.com/c/c690377c0d46a4-1-regal-1800x900x400-mm-lakovany-5-policovy-nosnost-875-kg-cerveny-pravy-18090405875red1.jpeg",
  "Modr√°": "https://vyprodej-regalucz.s26.cdn-upgates.com/b/b690377c6f0f7e-1-regal-1800x900x400-mm-lakovany-5-policovy-nosnost-875-kg-modry-pravy-18090405875blue1.jpeg",
  "Zinkovan√Ω": "https://vyprodej-regalucz.s26.cdn-upgates.com/z/z6914605330838-5-pol-pravy-zink.jpg"
};

for (let i = 13; i <= 102; i++) {
  const height = heights[Math.floor(Math.random() * heights.length)];
  const width = widths[Math.floor(Math.random() * widths.length)];
  const depth = depths[Math.floor(Math.random() * depths.length)];
  const color = colors[Math.floor(Math.random() * colors.length)];
  const surface = color === "Zinkovan√Ω" ? "Pozinkovan√Ω" : "Lakovan√Ω";
  const shelves = height >= 180 ? 5 : 4;
  const capacity = shelves * 175;
  const basePrice = 400 + (height / 10) * 15 + (width / 10) * 10;
  const price = Math.round(basePrice / 10) * 10 - 1;
  const priceOrig = Math.round(price * 2) * 2;

  allProducts.push({
    id: i,
    code: `${height}${width}${depth}${shelves}${capacity}${color.substring(0,3).toUpperCase()}`,
    name: `Reg√°l ${height}√ó${width}√ó${depth} cm ${color.toLowerCase()}`,
    price: price,
    priceOrig: priceOrig,
    height: height,
    width: width,
    depth: depth,
    color: color,
    surface: surface,
    shelves: shelves,
    capacity: capacity,
    image: colorImages[color],
    seoUrl: `regal-${height}x${width}x${depth}-cm-${color.toLowerCase().replace('√°','a').replace('√Ω','y')}`,
    stock: Math.floor(Math.random() * 100) + 10,
    sold7days: Math.floor(Math.random() * 50) + 5
  });
}

// State
let filteredProducts = [...allProducts];
let activeFilters = { color: [], height: [], width: [], surface: [], capacity: [], usage: [] };
let currentPage = 1;
const productsPerPage = 12;
let currentView = 'grid';
let maxPrice = 2000;

// ========== URL GENERATION ==========
function getProductUrl(p) {
  // Generate clean URL like regal-180x90x40-cerna.html
  const colorMap = {
    'ƒåern√°': 'cerna',
    'B√≠l√°': 'bila',
    'ƒåerven√°': 'cervena',
    'Modr√°': 'modra',
    'Zinkovan√Ω': 'zinkovany'
  };
  const colorSlug = colorMap[p.color] || p.color.toLowerCase().replace(/[√°√©√≠√≥√∫√Ωƒçƒèƒõ≈à≈ô≈°≈•≈æ≈Ø]/g, c =>
    ({√°:'a',√©:'e',√≠:'i',√≥:'o',√∫:'u',√Ω:'y',ƒç:'c',ƒè:'d',ƒõ:'e',≈à:'n',≈ô:'r',≈°:'s',≈•:'t',≈æ:'z',≈Ø:'u'})[c] || c
  );
  return `regal-${p.height}x${p.width}x${p.depth}-${colorSlug}.html`;
}

// ========== RENDERING ==========
function renderProducts() {
  const start = (currentPage - 1) * productsPerPage;
  const end = start + productsPerPage;
  const pageProducts = filteredProducts.slice(start, end);

  const grid = document.getElementById('productGrid');

  if (currentView === 'grid') {
    grid.className = 'grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4';
  } else {
    grid.className = 'space-y-4';
  }

  grid.innerHTML = pageProducts.map(p => currentView === 'grid' ? renderGridCard(p) : renderListCard(p)).join('');

  document.getElementById('productCount').textContent = filteredProducts.length;
  renderPagination();
}

function renderGridCard(p) {
  const discount = Math.round((1 - p.price / p.priceOrig) * 100);
  const lowStock = p.stock < 20;
  const productUrl = getProductUrl(p);

  return `
    <div class="product-card bg-white rounded-xl overflow-hidden shadow-sm">
      <div class="relative">
        <a href="${productUrl}">
          <img src="${p.image}" alt="${p.name}" class="w-full aspect-square object-contain p-4 bg-gray-50">
        </a>
        <div class="absolute top-2 left-2 flex flex-col gap-1">
          <span class="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded">-${discount}%</span>
          ${p.bestseller ? '<span class="bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded">‚≠ê HIT</span>' : ''}
        </div>
        ${lowStock ? '<div class="absolute bottom-2 left-2 bg-orange-500 text-white text-xs px-2 py-1 rounded">Zb√Ωv√° ${p.stock} ks!</div>' : ''}
      </div>
      <div class="p-4">
        <a href="${productUrl}" class="font-medium text-sm hover:text-primary-500 line-clamp-2 mb-2">${p.name}</a>
        <div class="text-xs text-gray-500 mb-2">${p.height}√ó${p.width}√ó${p.depth} cm ‚Ä¢ ${p.capacity} kg</div>
        <div class="flex items-baseline gap-2 mb-3">
          <span class="text-xl font-bold text-primary-600">${p.price} Kƒç</span>
          <span class="text-sm text-gray-400 line-through">${p.priceOrig} Kƒç</span>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-xs text-green-600">‚úì Skladem</span>
          <button onclick="event.preventDefault(); addToCart(${p.id})" class="bg-primary-500 hover:bg-primary-600 text-white px-3 py-1.5 rounded-lg text-sm font-medium transition">
            Do ko≈°√≠ku
          </button>
        </div>
        <div class="text-xs text-orange-600 mt-2">üî• Koupeno ${p.sold7days}√ó za 7 dn√≠</div>
      </div>
    </div>
  `;
}

function renderListCard(p) {
  const discount = Math.round((1 - p.price / p.priceOrig) * 100);
  const productUrl = getProductUrl(p);
  return `
    <div class="product-card bg-white rounded-xl overflow-hidden shadow-sm flex">
      <div class="w-48 flex-shrink-0 relative">
        <a href="${productUrl}">
          <img src="${p.image}" alt="${p.name}" class="w-full h-full object-contain p-4 bg-gray-50">
        </a>
        <span class="absolute top-2 left-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded">-${discount}%</span>
      </div>
      <div class="flex-1 p-4 flex flex-col justify-between">
        <div>
          <a href="${productUrl}" class="font-bold text-lg hover:text-primary-500">${p.name}</a>
          <div class="text-sm text-gray-500 mt-1">${p.height}√ó${p.width}√ó${p.depth} cm ‚Ä¢ ${p.shelves} polic ‚Ä¢ Nosnost ${p.capacity} kg ‚Ä¢ ${p.surface}</div>
        </div>
        <div class="flex items-center justify-between mt-4">
          <div>
            <span class="text-2xl font-bold text-primary-600">${p.price} Kƒç</span>
            <span class="text-sm text-gray-400 line-through ml-2">${p.priceOrig} Kƒç</span>
          </div>
          <button onclick="event.preventDefault(); addToCart(${p.id})" class="bg-primary-500 hover:bg-primary-600 text-white px-6 py-2 rounded-lg font-medium transition">
            Do ko≈°√≠ku ‚Üí
          </button>
        </div>
      </div>
    </div>
  `;
}

function renderPagination() {
  const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
  const pagination = document.getElementById('pagination');
  let html = '';

  for (let i = 1; i <= totalPages; i++) {
    if (i === currentPage) {
      html += `<button class="w-10 h-10 bg-primary-500 text-white rounded-lg font-medium">${i}</button>`;
    } else {
      html += `<button onclick="goToPage(${i})" class="w-10 h-10 border rounded-lg hover:bg-gray-100">${i}</button>`;
    }
  }

  pagination.innerHTML = html;
}

// ========== FILTERING ==========
function toggleFilter(type, value) {
  const btn = document.querySelector(`[data-filter="${type}-${value}"]`);
  const index = activeFilters[type].indexOf(value);

  if (index > -1) {
    activeFilters[type].splice(index, 1);
    btn.classList.remove('active');
  } else {
    activeFilters[type].push(value);
    btn.classList.add('active');
  }

  applyFilters();
}

function filterByPrice(value) {
  maxPrice = parseInt(value);
  document.getElementById('priceRangeValue').textContent = value + ' Kƒç';
  applyFilters();
}

function applyFilters() {
  filteredProducts = allProducts.filter(p => {
    // Color filter - if colors are selected, product color must match one of them
    if (activeFilters.color.length > 0) {
      if (!activeFilters.color.includes(p.color)) return false;
    }

    // Height filter
    if (activeFilters.height.length > 0) {
      if (!activeFilters.height.includes(String(p.height))) return false;
    }

    // Width filter
    if (activeFilters.width.length > 0) {
      if (!activeFilters.width.includes(String(p.width))) return false;
    }

    // Surface filter
    if (activeFilters.surface.length > 0) {
      if (!activeFilters.surface.includes(p.surface)) return false;
    }

    // Capacity filter
    if (activeFilters.capacity.length > 0) {
      if (!activeFilters.capacity.some(c => p.capacity >= parseInt(c))) return false;
    }

    // Price filter
    if (p.price > maxPrice) return false;

    return true;
  });

  currentPage = 1;
  renderProducts();
  renderActiveFilters();
}

function renderActiveFilters() {
  const container = document.getElementById('activeFilters');
  const hasFilters = Object.values(activeFilters).some(arr => arr.length > 0);

  if (!hasFilters) {
    container.classList.add('hidden');
    return;
  }

  container.classList.remove('hidden');
  let html = '';

  Object.entries(activeFilters).forEach(([type, values]) => {
    values.forEach(value => {
      html += `<span class="bg-primary-100 text-primary-700 px-3 py-1 rounded-full text-sm flex items-center gap-1">
        ${value}
        <button onclick="toggleFilter('${type}', '${value}')" class="hover:text-primary-900">√ó</button>
      </span>`;
    });
  });

  container.innerHTML = html;
}

function resetFilters() {
  activeFilters = { color: [], height: [], width: [], surface: [], capacity: [], usage: [] };
  maxPrice = 2000;
  document.getElementById('priceRange').value = 2000;
  document.getElementById('priceRangeValue').textContent = '2000 Kƒç';
  document.querySelectorAll('.filter-chip').forEach(btn => btn.classList.remove('active'));
  filteredProducts = [...allProducts];
  currentPage = 1;
  renderProducts();
  renderActiveFilters();
}

// ========== SORTING ==========
function sortProducts() {
  const sortBy = document.getElementById('sortSelect').value;

  switch(sortBy) {
    case 'price-asc':
      filteredProducts.sort((a, b) => a.price - b.price);
      break;
    case 'price-desc':
      filteredProducts.sort((a, b) => b.price - a.price);
      break;
    case 'name':
      filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
      break;
    case 'capacity':
      filteredProducts.sort((a, b) => b.capacity - a.capacity);
      break;
    default: // popular
      filteredProducts.sort((a, b) => b.sold7days - a.sold7days);
  }

  renderProducts();
}

// ========== PAGINATION ==========
function goToPage(page) {
  currentPage = page;
  renderProducts();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function changePage(delta) {
  const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
  const newPage = currentPage + delta;
  if (newPage >= 1 && newPage <= totalPages) {
    goToPage(newPage);
  }
}

// ========== VIEW TOGGLE ==========
function setView(view) {
  currentView = view;
  document.getElementById('viewGrid').className = view === 'grid' ? 'p-2 rounded-lg bg-primary-100 text-primary-600' : 'p-2 rounded-lg hover:bg-gray-100';
  document.getElementById('viewList').className = view === 'list' ? 'p-2 rounded-lg bg-primary-100 text-primary-600' : 'p-2 rounded-lg hover:bg-gray-100';
  renderProducts();
}

// ========== SEARCH (Luigi's Box Style) ==========
function handleSearch(event) {
  const query = event.target.value.toLowerCase();

  if (query.length < 2) {
    document.getElementById('searchDropdown').classList.add('hidden');
    return;
  }

  showSearchDropdown();

  // Filter products
  const results = allProducts.filter(p =>
    p.name.toLowerCase().includes(query) ||
    p.color.toLowerCase().includes(query) ||
    String(p.height).includes(query) ||
    String(p.width).includes(query)
  ).slice(0, 6);

  // Categories
  const categories = [];
  if (query.includes('180') || query.includes('vysok')) categories.push({ name: 'reg√°ly v√Ω≈°ky 180 cm', count: 34 });
  if (query.includes('90') || query.includes('≈°irok')) categories.push({ name: 'reg√°ly ≈°√≠≈ôky 90 cm', count: 28 });
  if (query.includes('ƒçern') || query.includes('black')) categories.push({ name: 'ƒçern√© reg√°ly', count: 42 });
  if (query.includes('b√≠l') || query.includes('white')) categories.push({ name: 'b√≠l√© reg√°ly', count: 18 });
  if (query.includes('zink') || query.includes('vlhk')) categories.push({ name: 'zinkovan√© reg√°ly', count: 24 });
  if (query.includes('gar√°≈æ')) categories.push({ name: 'reg√°ly do gar√°≈æe', count: 56 });
  if (query.includes('sklep')) categories.push({ name: 'reg√°ly do sklepa', count: 48 });

  // Render categories
  document.getElementById('searchCategories').innerHTML = categories.length ?
    categories.map(c => `<a href="?kategorie=${encodeURIComponent(c.name)}" class="block text-sm text-gray-700 hover:text-primary-500 py-1">${c.name} <span class="text-gray-400">(${c.count})</span></a>`).join('') :
    '<p class="text-sm text-gray-400">≈Ω√°dn√© kategorie</p>';

  // Top product
  const topProduct = results.find(p => p.bestseller) || results[0];
  if (topProduct) {
    const topProductUrl = getProductUrl(topProduct);
    document.getElementById('searchTopProduct').innerHTML = `
      <a href="${topProductUrl}" class="block">
        <img src="${topProduct.image}" alt="${topProduct.name}" class="w-full aspect-square object-contain bg-white rounded-lg mb-2">
        <div class="space-y-1">
          <span class="bg-red-500 text-white text-xs px-2 py-0.5 rounded">Akce</span>
          <span class="bg-green-500 text-white text-xs px-2 py-0.5 rounded">Ovƒõ≈ôen√° Kvalita</span>
          <span class="bg-teal-500 text-white text-xs px-2 py-0.5 rounded">Z√°ruka 7 let</span>
        </div>
        <h4 class="font-medium text-sm mt-2 line-clamp-2">${topProduct.name}</h4>
        <div class="text-green-600 text-xs mt-1">Skladem</div>
        <div class="mt-2">
          <span class="text-xl font-bold">${topProduct.price} Kƒç</span>
          <span class="text-sm text-gray-400 line-through ml-1">${topProduct.priceOrig} Kƒç</span>
        </div>
        <button class="w-full bg-primary-500 text-white py-2 rounded-lg font-medium mt-3 hover:bg-primary-600 transition">DO KO≈†√çKU</button>
      </a>
    `;
  }

  // Products list
  document.getElementById('searchProducts').innerHTML = results.map(p => `
    <a href="${getProductUrl(p)}" class="flex gap-3 hover:bg-gray-50 rounded-lg p-2 -m-2">
      <img src="${p.image}" alt="${p.name}" class="w-16 h-16 object-contain bg-gray-100 rounded">
      <div class="flex-1 min-w-0">
        <div class="text-sm font-medium line-clamp-1">${p.name}</div>
        <div class="text-xs text-green-600">Skladem</div>
        <div class="text-sm font-bold text-primary-600">${p.price} Kƒç</div>
      </div>
      <button onclick="event.preventDefault(); addToCart(${p.id})" class="w-8 h-8 bg-primary-100 hover:bg-primary-200 rounded-full flex items-center justify-center text-primary-600 flex-shrink-0">üõí</button>
    </a>
  `).join('') || '<p class="text-sm text-gray-400">≈Ω√°dn√© produkty</p>';

  document.getElementById('searchShowAll').href = `?hledat=${encodeURIComponent(query)}`;
}

function showSearchDropdown() {
  document.getElementById('searchDropdown').classList.remove('hidden');
}

function performSearch() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  if (query) {
    filteredProducts = allProducts.filter(p =>
      p.name.toLowerCase().includes(query) ||
      p.color.toLowerCase().includes(query) ||
      String(p.height).includes(query)
    );
    currentPage = 1;
    renderProducts();
    document.getElementById('searchDropdown').classList.add('hidden');
  }
}

// Close search dropdown when clicking outside
document.addEventListener('click', (e) => {
  if (!e.target.closest('#searchInput') && !e.target.closest('#searchDropdown')) {
    document.getElementById('searchDropdown').classList.add('hidden');
  }
});

// ========== CART ==========
let cart = [];

function addToCart(productId) {
  const product = allProducts.find(p => p.id === productId);
  if (!product) return;

  // Redirect to vyprodej-regalu.cz with UTM tracking
  const url = `https://www.vyprodej-regalu.cz/p/${product.seoUrl}?addtocart=1&quantity=1&return=cart&utm_source=bazarovyregal&utm_medium=affiliate&utm_campaign=katalog`;
  window.open(url, '_blank');

  // Also update local cart for UX
  cart.push(product);
  document.getElementById('cartCount').textContent = cart.length;
  showNotification(product);
}

// ========== NOTIFICATIONS ==========
function showNotification(product) {
  const container = document.getElementById('notificationContainer');
  const notification = document.createElement('div');
  notification.className = 'notification-toast bg-white rounded-lg shadow-lg p-4 flex items-center gap-3 max-w-sm';
  notification.innerHTML = `
    <img src="${product.image}" alt="" class="w-12 h-12 object-contain bg-gray-100 rounded">
    <div>
      <div class="text-sm font-medium">P≈ôid√°no do ko≈°√≠ku</div>
      <div class="text-xs text-gray-500">${product.name}</div>
    </div>
  `;
  container.appendChild(notification);

  setTimeout(() => notification.remove(), 5000);
}

// Live purchase notifications
const names = ['Jan', 'Petr', 'Martin', 'Tom√°≈°', 'Pavel', 'Lucie', 'Eva', 'Anna', 'Marie', 'Kate≈ôina'];
const cities = ['Praha', 'Brno', 'Ostrava', 'Plze≈à', 'Liberec', 'Olomouc', 'ƒåesk√© Budƒõjovice', 'Hradec Kr√°lov√©'];

function showLivePurchase() {
  const name = names[Math.floor(Math.random() * names.length)];
  const city = cities[Math.floor(Math.random() * cities.length)];
  const product = allProducts[Math.floor(Math.random() * 20)];
  const minutes = Math.floor(Math.random() * 15) + 1;

  const container = document.getElementById('notificationContainer');
  const notification = document.createElement('div');
  notification.className = 'notification-toast bg-white rounded-lg shadow-lg p-4 flex items-center gap-3 max-w-sm border-l-4 border-green-500';
  notification.innerHTML = `
    <img src="${product.image}" alt="" class="w-12 h-12 object-contain bg-gray-100 rounded">
    <div>
      <div class="text-sm"><strong>${name}</strong> z mƒõsta <strong>${city}</strong></div>
      <div class="text-xs text-gray-500">pr√°vƒõ koupil(a) ${product.name}</div>
      <div class="text-xs text-gray-400">p≈ôed ${minutes} min</div>
    </div>
  `;
  container.appendChild(notification);

  setTimeout(() => notification.remove(), 5000);
}

// Show live purchase every 30-60 seconds
setInterval(showLivePurchase, Math.random() * 30000 + 30000);
setTimeout(showLivePurchase, 5000); // First one after 5s

// ========== EXIT INTENT POPUP ==========
let exitPopupShown = false;

document.addEventListener('mouseout', (e) => {
  if (e.clientY < 10 && !exitPopupShown) {
    document.getElementById('exitPopup').classList.remove('hidden');
    document.getElementById('exitPopup').classList.add('flex');
    document.getElementById('exitPopupContent').classList.remove('scale-95');
    exitPopupShown = true;
  }
});

function closeExitPopup() {
  document.getElementById('exitPopup').classList.add('hidden');
  document.getElementById('exitPopup').classList.remove('flex');
}

// ========== COUNTDOWN ==========
function updateCountdown() {
  const now = new Date();
  const end = new Date();
  end.setDate(end.getDate() + 2);
  end.setHours(23, 59, 59);

  const diff = end - now;
  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

  document.getElementById('countdownDays').textContent = days;
  document.getElementById('countdownHours').textContent = hours;
  document.getElementById('countdownMins').textContent = mins;
}

setInterval(updateCountdown, 60000);
updateCountdown();

// ========== AI CHAT ==========
const chatLog = [];

function toggleChat() {
  const window = document.getElementById('chatWindow');
  window.classList.toggle('hidden');
}

function sendMessage() {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  if (!message) return;

  // Add user message
  addChatMessage(message, 'user');
  chatLog.push({ role: 'user', message, time: new Date().toISOString() });
  input.value = '';

  // Simulate AI response
  setTimeout(() => {
    const response = generateAIResponse(message);
    addChatMessage(response, 'bot');
    chatLog.push({ role: 'bot', message: response, time: new Date().toISOString() });

    // Log to console (in real app, send to server)
    console.log('Chat Log:', chatLog);
  }, 1000);
}

function quickQuestion(question) {
  document.getElementById('chatInput').value = question;
  sendMessage();
}

function addChatMessage(message, sender) {
  const container = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'flex gap-3' + (sender === 'user' ? ' flex-row-reverse' : '');

  const avatar = sender === 'user' ? 'üë§' : 'ü§ñ';
  const bgColor = sender === 'user' ? 'bg-primary-500 text-white rounded-tr-none' : 'bg-gray-100 rounded-tl-none';

  div.innerHTML = `
    <div class="w-8 h-8 ${sender === 'user' ? 'bg-gray-200' : 'bg-primary-100'} rounded-full flex items-center justify-center flex-shrink-0">${avatar}</div>
    <div class="${bgColor} rounded-2xl p-3 text-sm max-w-[80%]">${message}</div>
  `;

  container.appendChild(div);
  container.scrollTop = container.scrollHeight;
}

function generateAIResponse(message) {
  const msg = message.toLowerCase();

  if (msg.includes('gar√°≈æ')) {
    return 'Pro gar√°≈æ doporuƒçuji na≈°e nejprod√°vanƒõj≈°√≠ <a href="?color=ƒåern√°" class="text-primary-500 underline">ƒçern√© reg√°ly 180√ó90√ó40 cm</a>. Maj√≠ nosnost 875 kg a jsou odoln√©. Cena od 739 Kƒç! üöó';
  }
  if (msg.includes('vlhk') || msg.includes('sklep')) {
    return 'Do vlhk√©ho prost≈ôed√≠ jednoznaƒçnƒõ <a href="?surface=Pozinkovan√Ω" class="text-primary-500 underline">zinkovan√© reg√°ly</a>! Jsou odoln√© proti korozi a vlhkosti. M√°me je od 649 Kƒç. üíß';
  }
  if (msg.includes('levn') || msg.includes('nejlevnƒõj≈°√≠')) {
    return 'Nejlevnƒõj≈°√≠ reg√°l m√°me za 599 Kƒç - je to <a href="regal-150x70x30-cerna.html" class="text-primary-500 underline">Reg√°l 150√ó70√ó30 cm</a>. Skvƒõl√Ω pomƒõr cena/v√Ωkon! üí∞';
  }
  if (msg.includes('nosnost') || msg.includes('tƒõ≈æk')) {
    return 'V≈°echny na≈°e reg√°ly maj√≠ vysokou nosnost 175 kg na polici. Celkov√° nosnost a≈æ 875 kg! To unese opravdu hodnƒõ. üí™';
  }
  if (msg.includes('doruƒçen√≠') || msg.includes('doprava')) {
    return 'Doruƒçujeme do 2-3 pracovn√≠ch dn≈Ø po cel√© ƒåR. Doprava od 99 Kƒç, nad 1000 Kƒç ZDARMA! üöö';
  }
  if (msg.includes('z√°ruka')) {
    return 'Na v≈°echny reg√°ly poskytujeme z√°ruku 7 let! To je jeden z nejdel≈°√≠ch z√°ruƒçn√≠ch obdob√≠ na trhu. üõ°Ô∏è';
  }
  if (msg.includes('mont√°≈æ') || msg.includes('sestav')) {
    return 'Mont√°≈æ je super jednoduch√° - bez≈°roubov√Ω syst√©m, zvl√°dnete to za 10 minut bez n√°≈ôad√≠! M√°me i video n√°vod. üîß';
  }

  return 'Dƒõkuji za dotaz! üòä Pomohu v√°m vybrat ide√°ln√≠ reg√°l. M≈Ø≈æete mi ≈ô√≠ct, kam ho chcete um√≠stit (gar√°≈æ, sklep, d√≠lna...) nebo jak√© m√°te po≈æadavky na velikost ƒçi nosnost?';
}

// ========== INIT ==========
renderProducts();
</script>

</body>
</html>
